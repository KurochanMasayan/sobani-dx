# 歯科診療スケジュール管理 AppSheet

訪問歯科診療のスケジュール管理・算定管理のためのAppSheetアプリケーション

## 背景・課題

- 歯科は医科と異なり、訪問回数が治療内容により大きく変動（入れ歯作成時は毎週、破損対応で連続訪問など）
- 定期訪問（2週間ごと）が基本だが、イレギュラー対応で予定変更が頻繁に発生
- 現状は2つのシート（診療スケジュール・タイムスケジュール）を別々に管理しており、**二重入力が発生**
- 歯科用デジタルレセコンがクラウド非対応のため、Googleスプレッドシートでの管理が最適

## 主要機能

1. **患者マスター管理** - 患者一覧の一元管理、選択項目の印刷機能
2. **スケジュール管理** - 患者名入力で施設情報自動表示、訪問回数自動カウント
3. **算定管理** - 居宅療養管理指導の算定上限管理

## 算定ルール

| 職種 | 上限回数 | 条件 |
|------|---------|------|
| 歯科医師 | 月2回まで | - |
| 歯科衛生士 | 月4回まで | 1回あたり20分以上の滞在必須 |

※ 訪問回数 ≠ 算定回数（月5回訪問しても、上限までしか算定できない）

## クイックスタート

### 1. Googleスプレッドシートの作成

1. Google Driveで新規スプレッドシート作成（名前：`歯科診療スケジュール管理`）
2. 以下のシートを作成し、CSVをインポート:

| シート名 | CSVファイル |
|---------|------------|
| 施設マスタ | `data-model/csv-data/施設マスタ.csv` |
| 患者マスタ | `data-model/csv-data/患者マスタ.csv` |
| 居宅介護支援事業所マスタ | `data-model/csv-data/居宅介護支援事業所マスタ.csv` |
| スタッフマスタ | `data-model/csv-data/スタッフマスタ.csv` |
| 診療スケジュール | `data-model/csv-data/診療スケジュール.csv` |

### 2. AppSheetアプリの作成

1. https://www.appsheet.com/ にアクセス
2. 「Create」→「App」→「Start with existing data」
3. 作成したスプレッドシートを選択
4. 詳細設定は [appsheet/setup-guide.md](appsheet/setup-guide.md) を参照

### 3. GAS（オートメーション連携）※任意

1. スプレッドシートで「拡張機能」→「Apps Script」
2. `gas-integration/Code.gs` の内容を貼り付け
3. Webアプリとしてデプロイ
4. AppSheetオートメーションから呼び出し

## フォルダ構造

```
dental-schedule-appsheet/
├── README.md
├── appsheet/
│   └── setup-guide.md          # AppSheetセットアップガイド
├── data-model/
│   ├── csv-data/               # マスタ・トランザクションデータ
│   │   ├── 施設マスタ.csv           (13件)
│   │   ├── 患者マスタ.csv           (45件)
│   │   ├── 居宅介護支援事業所マスタ.csv (22件)
│   │   ├── スタッフマスタ.csv        (3件:デモ)
│   │   └── 診療スケジュール.csv      (20件:デモ)
│   └── documentation/          # テーブル定義書
│       ├── 01_施設マスタ.md
│       ├── 02_居宅介護支援事業所マスタ.md
│       ├── 03_患者マスタ.md
│       ├── 04_スタッフマスタ.md
│       └── 05_診療スケジュール.md
├── documents/                  # 設計書
│   ├── 01_要件定義書.md
│   └── 02_ロジック設計書.md
└── gas-integration/            # GASコード
    ├── Code.gs                 # メインコード
    └── README.md               # GASセットアップガイド
```

## データモデル

```
┌──────────────┐
│ スタッフマスタ │ STF001〜 (医師/衛生士)
└──────┬───────┘
       │
       ▼ 担当医師ID / 担当衛生士ID
┌──────────────┐     ┌──────────────┐     ┌────────────────────┐
│  施設マスタ   │←────│  患者マスタ   │────→│居宅介護支援事業所マスタ│
│  FAC001〜    │     │              │     │     CMP001〜       │
└──────────────┘     └──────┬───────┘     └────────────────────┘
       ▲                    │
       │ 施設ID             │ 患者ID
       │                    ▼
       │            ┌──────────────┐
       └────────────│診療スケジュール│ SCH-YYYYMMDD-NNN
                    └──────────────┘
```

## 核心ロジック

### 算定回数の自動計算

```
当月医師算定回数 = COUNT(診療スケジュール WHERE 患者=本患者 AND 医師算定=TRUE AND 年月=今月)
医師算定残り = MAX(0, 2 - 当月医師算定回数)

当月衛生士算定回数 = COUNT(診療スケジュール WHERE 患者=本患者 AND 衛生士算定=TRUE AND 年月=今月)
衛生士算定残り = MAX(0, 4 - 当月衛生士算定回数)
```

### 二重入力問題の解決

```
【Before】                          【After】
診療スケジュール ─┐                 診療スケジュール（統合テーブル）
                  ├→ 二重入力           │
タイムスケジュール─┘                     ├→ 月間カレンダービュー
                                        ├→ 本日スケジュールビュー
                                        └→ タイムスケジュールPDF (GAS)
```

## デモデータ

### スタッフ（3名）
| ID | 名前 | 役職 |
|----|------|------|
| STF001 | 山田 太郎 | 歯科医師 |
| STF002 | 鈴木 花子 | 歯科衛生士 |
| STF003 | 佐藤 次郎 | 歯科衛生士 |

### スケジュール（2025年1月）
- 1/20（月）: シェノール、セラス → 3患者
- 1/22（水）: ベース → 4患者
- 1/24（金）: ディールエンハイス → 3患者
- 1/27（月）: シェノール、ネクストコート → 4患者
- 1/29（水）: わだ家 → 3患者
- 1/31（金）: セラス → 3患者

## 開発状況

- [x] 要件定義
- [x] ロジック設計
- [x] データモデル設計（マスタ5テーブル + トランザクション1テーブル）
- [x] デモデータ作成
- [x] AppSheetセットアップガイド作成
- [x] GASコード作成（タイムスケジュールPDF出力）
- [ ] AppSheetアプリ作成（ユーザー側作業）
- [ ] GASデプロイ（ユーザー側作業）
- [ ] 本番データ移行
- [ ] テスト
- [ ] 運用開始

## ドキュメント一覧

| ドキュメント | 内容 |
|-------------|------|
| [01_要件定義書](documents/01_要件定義書.md) | システムの必要性、主要機能要件 |
| [02_ロジック設計書](documents/02_ロジック設計書.md) | 業務フロー、算定ルール、計算ロジック、画面設計 |
| [AppSheetセットアップ](appsheet/setup-guide.md) | AppSheet設定の詳細手順 |
