# 訪問診療 医材在庫管理システム 要件定義書

## 概要

訪問診療における医材の在庫管理システム。施設内の患者への医材配布、箱単位での在庫管理と個数単位での配布管理、発注管理を効率化し、適切な在庫レベルを維持する。医材は箱単位で在庫するが、実際の配布は個数単位で行う。

## 技術的前提

- **プラットフォーム**: Google AppSheet
- **データソース**: Google スプレッドシート
- **認証**: Google アカウント
- **アクセス**: モバイル・タブレット対応（訪問診療での利用）

## 要件

### 要件 1: 施設・患者管理

**ユーザーストーリー:** 訪問診療スタッフとして、各施設とその施設内の患者情報を管理したい。これにより、どの施設にどの患者がいるかを把握し、適切な薬剤配布を行える。

#### 受入基準

1. WHEN 新しい施設を登録する THEN システムは施設名、住所、連絡先を記録する SHALL
2. WHEN 施設に患者を追加する THEN システムは患者名、患者 ID、所属施設を記録する SHALL
3. WHEN 施設情報を表示する THEN システムは施設に所属する全患者のリストを表示する SHALL

### 要件 2: 医材マスタ管理

**ユーザーストーリー:** 薬剤師として、取り扱う医材の基本情報を管理したい。これにより、正確な医材情報に基づいて在庫管理と配布を行える。

#### 受入基準

1. WHEN 新しい医材を登録する THEN システムは商品コード、管理番号、商品名、臨床区分、箱あたり個数、単位、発注先を記録する SHALL
2. WHEN 医材の定数在庫設定を行う THEN システムは定数在庫フラグと定数在庫数（箱単位）を記録する SHALL
3. WHEN 医材情報を編集する THEN システムは変更内容を保存し、更新日時を記録する SHALL
4. WHEN 医材を検索する THEN システムは商品名または商品コードで検索結果を表示する SHALL

### 要件 3: 配布テンプレート管理

**ユーザーストーリー:** 訪問診療スタッフとして、患者ごとの定期的な医材配布パターンをテンプレートとして保存したい。これにより、毎回同じ配布内容を入力する手間を省ける。

#### 受入基準

1. WHEN 患者の配布テンプレートを作成する THEN システムは患者 ID、医材、配布数量（個数単位）、配布頻度を記録する SHALL
2. WHEN 偶数月用テンプレートを設定する THEN システムは偶数月専用の配布数量（個数単位）を記録する SHALL
3. WHEN 奇数月用テンプレートを設定する THEN システムは奇数月専用の配布数量（個数単位）を記録する SHALL
4. WHEN 現在の月に基づいてテンプレートを表示する THEN システムは偶数月または奇数月に応じた適切なテンプレートを表示する SHALL

### 要件 4: 医材配布記録

**ユーザーストーリー:** 訪問診療スタッフとして、施設への医材配布を記録したい。これにより、実際の配布量を追跡し、在庫を正確に管理できる。

#### 受入基準

1. WHEN 施設への配布を記録する THEN システムは配布日、施設、患者、医材、配布数量（個数単位）を記録する SHALL
2. WHEN テンプレートから配布を実行する THEN システムはテンプレートの内容を配布記録として自動入力する SHALL
3. WHEN 配布記録を確認する THEN システムは指定期間の配布履歴を施設別、患者別に表示する SHALL
4. WHEN 配布を記録する THEN システムは該当医材の在庫数量（個数単位）から配布数量を自動減算する SHALL

### 要件 5: 在庫管理

**ユーザーストーリー:** 薬剤師として、各医材の現在在庫数を把握したい。これにより、適切なタイミングで発注を行い、在庫切れを防げる。

#### 受入基準

1. WHEN 在庫一覧を表示する THEN システムは全医材の現在在庫数量を箱単位と個数単位の両方で表示する SHALL
2. WHEN 医材が配布される THEN システムは該当医材の在庫数量（個数単位）を自動的に減算する SHALL
3. WHEN 医材が入荷する THEN システムは該当医材の在庫数量を箱単位で加算し、個数単位に換算する SHALL
4. WHEN 定数在庫の医材で在庫が定数を下回る THEN システムは警告表示を行う SHALL
5. WHEN 在庫数量を表示する THEN システムは「X 箱 Y 個（合計 Z 個）」の形式で表示する SHALL

### 要件 6: 発注管理

**ユーザーストーリー:** 薬剤師として、医材の発注を記録し、入荷を管理したい。これにより、発注から入荷までの流れを追跡し、適切な在庫補充を行える。

#### 受入基準

1. WHEN 医材を発注する THEN システムは発注日、医材、発注数量（箱単位）、発注先を記録する SHALL
2. WHEN 発注した医材が入荷する THEN システムは入荷日と入荷数量（箱単位）を別テーブルに記録し、在庫に加算する SHALL
3. WHEN 発注履歴を確認する THEN システムは受入済数量と残数量を集計し、未入荷/一部入荷/入荷完了を区別して表示する SHALL

### 要件 7: レポート機能

**ユーザーストーリー:** 管理者として、医材の使用状況と在庫状況を定期的に確認したい。これにより、適切な在庫管理と業務改善を行える。

#### 受入基準

1. WHEN 月次配布レポートを生成する THEN システムは施設別、患者別、医材別の配布数量（個数単位）を集計表示する SHALL
2. WHEN 在庫状況レポートを生成する THEN システムは現在在庫（箱・個数）と定数在庫レベルを表示する SHALL
3. WHEN 偶数月・奇数月の使用量を比較する THEN システムは月タイプ別の配布数量の違いを表示する SHALL
