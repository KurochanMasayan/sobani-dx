# 訪問診療 医材在庫管理システム データモデル

このディレクトリには、訪問診療における医材在庫管理システムのデータベース設計書が含まれています。

## ディレクトリ構成

```
data-model/
├── README.md               # このファイル
├── documentation/          # テーブル設計書
│   ├── 00_システム概要.md   # システム全体の概要
│   ├── 01_施設マスタ.md    # facilities テーブル定義
│   ├── 02_患者マスタ.md    # patients テーブル定義
│   ├── 03_商品マスタ.md    # 商品マスタ テーブル定義
│   ├── 04_発注先マスタ.md  # 発注先マスタ テーブル定義
│   ├── 05_配布テンプレート.md # 配布テンプレート テーブル定義
│   ├── 06_調整記録.md      # 調整記録 テーブル定義
│   ├── 07_配布記録.md      # 配布記録 テーブル定義
│   ├── 08_発注記録.md      # 発注記録 テーブル定義
│   ├── 09_在庫変動履歴.md  # 在庫変動履歴 テーブル定義
│   ├── 11_入荷記録.md      # 入荷記録 テーブル定義
│   ├── 12_箱詰記録.md      # 箱詰記録 テーブル定義
│   ├── 14_セットテンプレートマスタ.md # セットテンプレートマスタ テーブル定義
│   ├── 15_セット構成明細.md # セット構成明細 テーブル定義
│   └── 16_臨時配布記録.md  # 臨時配布記録 テーブル定義
└── csv-data/              # CSVデータファイル（実データ格納用）
```

## テーブル概要

| テーブル名 | 説明 | 主キー |
|-----------|------|--------|
| 施設マスタ | 施設マスタ | facility_id |
| 患者マスタ | 患者マスタ | patient_id |
| 商品マスタ | 医材マスタ | supply_id |
| 発注先マスタ | 発注先マスタ | supplier_id |
| 配布テンプレート | 配布テンプレート | template_id |
| セットテンプレートマスタ | 臨時配布用セットテンプレート | set_template_id |
| セット構成明細 | セット構成商品詳細 | composition_id |
| 在庫管理 | 在庫管理 | inventory_id |
| 箱詰記録 | 箱詰記録（定期配布専用） | packing_id |
| 配布記録 | 配布記録（定期・臨時配布統合） | distribution_id |
| 臨時配布記録 | 臨時配布記録 | emergency_distribution_id |
| 発注記録 | 発注記録 | order_id |
| 入荷記録 | 入荷記録 | receipt_id |
| 在庫変動履歴 | 在庫変動履歴 | transaction_id |

## 主要機能

1. **施設・患者管理**: 訪問先施設と患者情報の管理
2. **医材マスタ管理**: 取り扱い医材の基本情報管理
3. **配布テンプレート管理**: 患者別の定期配布パターン管理（偶数月・奇数月対応）
4. **セットテンプレート管理**: 臨時配布用の医材セット（点滴セット、抗生剤セット等）管理
5. **箱詰記録**: 定期配布の箱詰め作業記録
6. **配布記録**: 定期・臨時配布の最終実績を統合管理
7. **臨時配布記録**: セットテンプレートを使用した臨時配布の依頼・準備管理
8. **在庫管理**: 箱単位・個数単位での在庫管理
9. **発注記録**: 発注申請・承認・ステータス管理
10. **入荷記録**: 発注に対する分割入荷の記録と在庫反映
11. **在庫変動履歴**: 全ての在庫変動を記録

## データ形式

- 文字コード: UTF-8（BOM付き）
- CSVヘッダー: 日本語カラム名を使用
- 日付形式: YYYY-MM-DD
- 日時形式: YYYY-MM-DD HH:MM:SS
- ID形式:
  - 施設ID: faci-XXX
  - 患者ID: 6桁数字
  - 商品ID: PRD-XXX
  - 発注先ID: store-XX
  - テンプレートID: TMPL-XXX
  - セットID: SET-XXX
  - その他ID: UniqueID（自動生成）

## AppSheet実装手順

1. 各テーブル設計書（documentation/）を参照
2. Google スプレッドシートに各テーブルを作成
3. AppSheetでテーブルを追加
4. カラム型とリレーションを設定
5. 計算式と初期値を設定
6. ビューとアクションを作成

## 更新履歴

- 2024-10-20: 臨時配布機能の設計変更
  - 配布記録テーブルを新規追加（定期・臨時配布の統合管理）
  - 臨時配布記録テーブルを新規追加（中間テーブルとして機能）
  - セットテンプレートマスタ・セット構成明細を追加
  - 箱詰記録を定期配布専用に変更
  - データフローを「箱詰記録→配布記録→在庫変動履歴」に統一
- 2024-09-20: 要件定義書に基づく全面改訂
- 2024-09-19: 初版作成
