# 入荷記録

## テーブル概要
- **テーブル名**: 入荷記録
- **説明**: 発注レコードに紐づく入荷情報（分割入荷対応）を記録
- **主キー**: 入荷ID

## カラム定義

| カラム名 | 物理名 | データ型 | 必須 | 列種別 | 説明 |
|---------|--------|----------|------|--------|------|
| 入荷ID | receipt_id | UniqueID | ✓ | 物理 | 一意識別子（自動生成） |
| 発注ID | order_id | Ref | ✓ | 物理 | 紐づく発注（発注記録参照、IsPartOf = TRUE） |
| 入荷日 | delivery_date | Date | ✓ | 物理 | 入荷日 |
| 入荷数量_箱 | received_quantity_boxes | Number | ✓ | 物理 | 入荷箱数 |
| ロット番号 | lot_number | Text |  | 物理 | 入荷ロット番号（任意） |
| 検品者 | inspected_by | Email |  | 物理 | 入荷検品担当者 |
| 備考 | notes | Text |  | 物理 | 特記事項 |
| 作成日時 | created_at | DateTime | ✓ | 物理 | レコード作成日時 |
| 商品ID | product_id | Ref | | 仮想 | 発注レコードから取得（計算式: [発注ID].[商品ID]） |
| 商品名 | product_name | Text | | 仮想 | 商品名（計算式: [発注ID].[商品名]） |
| 発注数量_箱 | order_quantity_boxes | Number | | 仮想 | 発注箱数（計算式: [発注ID].[発注数量_箱]） |
| 残数量_箱 | remaining_boxes | Number | | 仮想 | 入荷後の残数量（計算式: [発注ID].[残数量_箱]） |

## AppSheet設定
- **ラベル**: CONCATENATE([発注ID], "-", [入荷日])
- **キー**: 入荷ID
- **IsPartOf**: 発注記録テーブルの [関連入荷] に対して TRUE
- **初期値**:
  - 入荷日 = TODAY()
  - 作成日時 = NOW()
  - 検品者 = USEREMAIL()
- **計算式**:
  - 商品ID = [発注ID].[商品ID]
  - 商品名 = [発注ID].[商品名]
  - 発注数量_箱 = [発注ID].[発注数量_箱]
- **アクション**:
  - 追加時に 在庫管理[stock_boxes] を入荷数量分加算し、端数（stock_pieces）も調整
  - 発注ステータス更新（SUM入荷数量に応じて 発注記録[状態] を変更）
- **条件付き書式**:
  - 残数量_箱 = 0 → 緑背景（入荷完了）
  - 残数量_箱 > 0 → オレンジ背景（未完了）

## ビュー例
- 発注詳細ビュー内の入荷サブテーブル（テーブルビュー）
- 入荷履歴ビュー（デッキビュー）

## 注意事項
- 同一発注に複数入荷レコードを登録可能（分割入荷対応）
- 入荷数量の合計が発注数量を超えないようバリデーションを設定
- 入荷キャンセル時は記録を削除するのではなく備考に理由を残す運用を想定
