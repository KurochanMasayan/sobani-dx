# 在庫管理 (inventory)

## テーブル概要
- **テーブル名**: inventory
- **説明**: 各医材の現在在庫数を管理
- **主キー**: 商品ID

## カラム定義

| カラム名 | 物理名 | データ型 | 必須 | 列種別 | 説明 |
|---------|--------|----------|------|--------|------|
| 商品ID | product_id | Ref | ✓ | 物理 | 商品（products参照） |
| 現在在庫_箱 | current_stock_boxes | Number | ✓ | 物理 | 現在の在庫箱数 |
| 現在在庫_個 | current_stock_pieces | Number | ✓ | 物理 | 現在の在庫個数（端数） |
| 最終更新日時 | last_updated | DateTime | ✓ | 物理 | 最終在庫更新日時 |
| 最低在庫_箱 | minimum_stock_boxes | Number | | 物理 | 発注点（箱単位） |
| 発注推奨数_箱 | reorder_quantity | Number | | 物理 | 推奨発注数（箱単位） |
| 商品名 | product_name | Text | | 仮想 | 商品名（計算式: [商品ID].[商品名]） |
| 箱入数 | pieces_per_box | Number | | 仮想 | 箱入数（計算式: [商品ID].[箱入数]） |
| 合計在庫_個数 | total_stock_pieces | Number | | 仮想 | 合計在庫個数（計算式: ([現在在庫_箱] * [箱入数]) + [現在在庫_個]） |
| 在庫表示 | stock_display | Text | | 仮想 | 在庫表示（計算式: CONCATENATE([現在在庫_箱], "箱 ", [現在在庫_個], "個（合計:", [合計在庫_個数], "個）")） |
| 在庫不足フラグ | stock_shortage_flag | Yes/No | | 仮想 | 在庫不足（計算式: IF([現在在庫_箱] < [最低在庫_箱], TRUE, FALSE)） |
| 定数在庫_箱 | fixed_stock_boxes | Number | | 仮想 | 定数在庫（計算式: [商品ID].[定数在庫_箱]） |
| 在庫充足率 | stock_fulfillment_rate | Percent | | 仮想 | 充足率（計算式: IF([定数在庫_箱] > 0, [現在在庫_箱] / [定数在庫_箱], 1)） |

## AppSheet設定
- **ラベル**: [商品ID].[商品名]
- **キー**: 商品ID
- **リレーション**: 商品ID → products.product_id
- **計算式**:
  - 合計在庫_個数 = ([現在在庫_箱] * [商品ID].[箱入数]) + [現在在庫_個]
  - 在庫不足フラグ = IF([現在在庫_箱] < [最低在庫_箱], TRUE, FALSE)
- **表示形式**:
  - 在庫表示 = CONCATENATE([現在在庫_箱], "箱 ", [現在在庫_個], "個（合計:", [合計在庫_個数], "個）")
- **条件付き書式**:
  - 在庫不足時: 赤背景で警告表示