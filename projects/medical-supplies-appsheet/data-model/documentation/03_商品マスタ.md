# 商品マスタ (products)

## テーブル概要
- **テーブル名**: products
- **説明**: 医材の基本情報と在庫数を一元管理
- **主キー**: 商品ID
- **役割**: 医材マスタデータと在庫数の Single Source of Truth

## カラム定義

| カラム名 | 物理名 | データ型 | 必須 | 列種別 | 説明 |
|---------|--------|----------|------|--------|------|
| 商品ID | product_id | Text | ✓ | 物理 | 一意識別子（PRD-XXX形式） |
| 商品コード | product_code | Text | ✓ | 物理 | メーカー品番 |
| 管理番号 | management_number | Number | ✓ | 物理 | 社内管理番号 |
| 商品名 | product_name | Text | ✓ | 物理 | 医材名称 |
| 箱入数 | pieces_per_box | Number | ✓ | 物理 | 1箱あたりの個数 |
| 単位 | unit | Text | ✓ | 物理 | 個/本/袋/枚等 |
| 発注先ID | supplier_id | Ref | ✓ | 物理 | 発注先（suppliers参照） |
| 棚番号 | shelf_number | Text | | 物理 | 保管棚番号 |
| 段数 | shelf_level | Text | | 物理 | 保管段数 |
| 定数在庫 | fixed_stock_flag | Yes/No | | 物理 | 定数在庫管理フラグ（TRUE:定数管理/FALSE:個別配布） |
| 定数在庫_箱 | fixed_stock_boxes | Number | | 物理 | 定数在庫数（箱単位） |
| 現在在庫_箱 | current_stock_boxes | Number | ✓ | 物理 | 現在の在庫箱数 |
| 現在在庫_個 | current_stock_pieces | Number | ✓ | 物理 | 現在の在庫個数（端数） |
| 最低在庫_箱 | minimum_stock_boxes | Number | | 物理 | 発注点（箱単位） |
| 発注推奨数_箱 | reorder_quantity | Number | | 物理 | 推奨発注数（箱単位） |
| 最終在庫更新 | last_stock_updated | DateTime | ✓ | 物理 | 最終在庫更新日時 |
| 定数在庫_個数 | fixed_stock_pieces | Number | | 仮想 | 定数在庫個数（計算式: [定数在庫_箱] * [箱入数]） |
| 合計在庫_個数 | total_stock_pieces | Number | | 仮想 | 合計在庫個数（計算式: ([現在在庫_箱] * [箱入数]) + [現在在庫_個]） |
| 在庫表示 | stock_display | Text | | 仮想 | 在庫表示（計算式: CONCATENATE([現在在庫_箱], "箱 ", [現在在庫_個], "個（合計:", [合計在庫_個数], "個）")） |
| 在庫不足フラグ | stock_shortage_flag | Yes/No | | 仮想 | 在庫不足（計算式: IF([現在在庫_箱] < [最低在庫_箱], TRUE, FALSE)） |
| 在庫充足率 | stock_fulfillment_rate | Percent | | 仮想 | 充足率（計算式: IF([定数在庫_箱] > 0, [現在在庫_箱] / [定数在庫_箱], 1)） |
| 発注先名 | supplier_name | Text | | 仮想 | 発注先名（計算式: [発注先ID].[発注先名]） |

## AppSheet設定
- **ラベル**: 商品名
- **キー**: 商品ID
- **リレーション**: 発注先ID → suppliers.supplier_id
- **計算式**:
  - 定数在庫_個数 = [定数在庫_箱] * [箱入数]
  - 合計在庫_個数 = ([現在在庫_箱] * [箱入数]) + [現在在庫_個]
  - 在庫不足フラグ = IF([現在在庫_箱] < [最低在庫_箱], TRUE, FALSE)
- **表示形式**:
  - 在庫表示 = CONCATENATE([現在在庫_箱], "箱 ", [現在在庫_個], "個（合計:", [合計在庫_個数], "個）")
- **条件付き書式**:
  - 在庫不足時: 赤背景で警告表示