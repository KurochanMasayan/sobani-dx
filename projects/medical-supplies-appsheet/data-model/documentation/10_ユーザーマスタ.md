# ユーザーマスタ (users)

## テーブル概要
- **テーブル名**: users
- **説明**: システムを利用するユーザーの管理
- **主キー**: メールアドレス

## カラム定義

| カラム名 | 物理名 | データ型 | 必須 | 列種別 | 説明 |
|---------|--------|----------|------|--------|------|
| メールアドレス | email | Email | ✓ | 物理 | ログイン用メールアドレス（主キー） |
| 氏名 | name | Text | ✓ | 物理 | ユーザーの氏名 |
| ロール | role | Enum | ✓ | 物理 | 管理者/看護師/薬剤師/一般職員 |
| 有効フラグ | is_active | Yes/No | ✓ | 物理 | アカウント有効/無効 |
| 電話番号 | phone | Phone | | 物理 | 連絡先電話番号 |
| 備考 | notes | LongText | | 物理 | 特記事項 |
| ロールラベル | role_label | Text | | 仮想 | ロール表示（計算式: [ロール]） |
| ステータス | status | Text | | 仮想 | ステータス表示（計算式: IF([有効フラグ], "有効", "無効")） |
| 表示名 | display_name | Text | | 仮想 | 表示用名前（計算式: CONCATENATE([氏名], " (", [ロールラベル], ")")） |

## ロールの選択肢
- 管理者
- 看護師
- 薬剤師
- 一般職員

## 権限設定
| ロール | 権限 |
|--------|------|
| 管理者 | 全機能利用可能、ユーザー管理、システム設定 |
| 看護師 | 配布記録、在庫確認、発注依頼 |
| 薬剤師 | 医薬品管理、発注承認、在庫管理 |
| 一般職員 | 在庫確認、配布記録閲覧（編集不可） |

## AppSheet設定
- **ラベル**: [表示名]
- **キー**: メールアドレス
- **初期値**:
  - 有効フラグ = TRUE
- **並び順**: 氏名 ASC
- **フィルター条件**:
  - 管理者以外: [有効フラグ] = TRUE
  - 管理者: 全レコード表示
- **セキュリティフィルター**:
  - USEREMAIL() = [メールアドレス] OR [ロール] = "admin"
- **必須項目**: メールアドレス、氏名、ロール

## バリデーション
- メールアドレス: 重複不可（主キーのため自動的に保証）
- ロール変更: 管理者のみ実行可能
- 有効フラグ変更: 管理者のみ実行可能
- 最低1名の管理者が有効である必要あり

## 設計の考え方
- **ロールベースアクセス制御**: 役割に応じた権限管理
- **有効/無効管理**: 退職者のアカウントを無効化（削除はしない）
- **メールアドレスキー**: AppSheetのUSEREMAIL()関数と直接連携
- **シンプルな構成**: 所属施設の管理は別途運用で対応