# セットテンプレートマスタ

## テーブル概要
- **テーブル名**: セットテンプレートマスタ
- **説明**: 臨時配布で使用する医材セット（点滴セット、抗生剤セット等）のテンプレート管理
- **主キー**: セットID
- **役割**: 臨時配布時に複数の医材を一括で配布するためのテンプレート定義

## カラム定義

| カラム名 | 物理名 | データ型 | 必須 | 列種別 | 説明 |
|---------|--------|----------|------|--------|------|
| セットID | set_template_id | Text | ✓ | 物理 | 一意識別子（SET-XXX形式） |
| セット名 | set_name | Text | ✓ | 物理 | セット名称（点滴セット、抗生剤セット等） |
| カテゴリ | category | Text | | 物理 | 処置種別（点滴、創傷処置、検査等） |
| 説明 | description | LongText | | 物理 | 使用目的・内容説明 |
| 有効フラグ | is_active | Yes/No | ✓ | 物理 | 使用可否（デフォルト: TRUE） |
| 作成者 | created_by | Email | ✓ | 物理 | テンプレート作成者 |
| 作成日時 | created_at | DateTime | ✓ | 物理 | 作成日時 |
| 構成商品数 | component_count | Number | | 仮想 | 構成商品数（計算式: COUNT(SELECT(セット構成明細[構成ID], [セットID] = [_THISROW].[セットID]))） |
| セットラベル | set_label | Text | | 仮想 | 表示用ラベル（計算式: CONCATENATE([セット名], " (", [構成商品数], "品目)")） |

## AppSheet設定
- **ラベル**: [セットラベル]
- **キー**: セットID
- **リレーション**:
  - セット構成明細 ← セットID
- **初期値**:
  - 作成者 = USEREMAIL()
  - 作成日時 = NOW()
  - 有効フラグ = TRUE
- **計算式**:
  - 構成商品数 = COUNT(SELECT(セット構成明細[構成ID], [セットID] = [_THISROW].[セットID]))
  - セットラベル = CONCATENATE([セット名], " (", [構成商品数], "品目)")
- **バリデーション**:
  - セット名: 必須、重複不可
  - セットID: SET-XXX形式
- **フィルタ**: 有効フラグ = TRUE（通常ビュー）
- **並び順**: カテゴリ ASC, セット名 ASC

## ビジネスルール
1. セットテンプレートは医療処置別に分類管理
2. 臨時配布時に選択可能なテンプレートとして機能
3. 構成商品はセット構成明細テーブルで管理
4. 無効化されたテンプレートは新規配布では選択不可
5. 既存の配布記録との整合性保持のため削除は不可

## 他テーブルとの関係
- **セット構成明細**: 1対多の関係（セット→構成商品）
- **臨時配布記録**: 1対多の関係（セット→配布実績）

## ビュー例
- セットテンプレート一覧ビュー（カードビュー）
- カテゴリ別セット一覧ビュー（グループ化ビュー）
- セット詳細ビュー（詳細ビュー、構成明細含む）
- 無効セット管理ビュー（管理者用）

## 初期データ例
```csv
セットID,セット名,カテゴリ,説明,有効フラグ
SET-001,点滴セット,点滴処置,末梢静脈内点滴用の基本セット,TRUE
SET-002,抗生剤セット,薬剤投与,感染症治療用の抗生剤投与セット,TRUE
SET-003,創傷処置セット,創傷管理,褥瘡・創傷処置用の基本セット,TRUE
SET-004,採血セット,検査,血液検査用の採血セット,TRUE
SET-005,吸引セット,呼吸管理,痰吸引用の基本セット,TRUE
```