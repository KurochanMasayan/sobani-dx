# CSV発注リスト出力（シンプル版）

## 最もシンプルな実装方法

### 1. Export this view 機能を使用

AppSheetの標準機能「Export this view」を使用すれば、**アクション設定不要**で即座にCSVエクスポート可能。

```yaml
実装手順:
1. 「発注対象商品」ビューを作成
2. View Options → Show → "Export this view to a CSV file" を ON
3. 完了！
```

### 2. 発注対象商品ビューの設定

```yaml
View Name: 発注対象商品
For Table: 商品マスタ
View Type: Table
Row Filter: [発注対象フラグ] = TRUE

表示カラム（順番も重要）:
1. 商品ID
2. 商品名
3. JANコード
4. 現在在庫個数
5. 定数在庫_個数
6. 発注推奨箱数（仮想列）
7. 発注推奨個数（仮想列）
8. 単価_箱
9. 発注推定金額（仮想列）
10. 推奨発注先（仮想列）

View Options:
- Show: Export this view to a CSV file ✓
- Allow: Quick edit columns ✗（誤操作防止）
```

### 3. 必要な仮想列の追加（商品マスタ）

```yaml
Column: 発注推奨箱数
Formula:
  IF([発注対象フラグ],
    CEILING(([定数在庫_個数] - [現在在庫個数]) / [箱入数_個数]),
    0
  )

Column: 発注推奨個数
Formula: [発注推奨箱数] * [箱入数_個数]

Column: 発注推定金額
Formula: [発注推奨箱数] * [単価_箱]

Column: 推奨発注先
Formula:
  IF(ISNOTBLANK([優先発注先ID]),
    [優先発注先ID].[発注先名],
    "標準発注先"
  )
```

## 4. CSVエクスポートの使い方

### ユーザー操作
1. 「発注対象商品」ビューを開く
2. 画面右上の「**Export**」アイコンをタップ
3. CSVファイルがダウンロードされる
4. ファイル名: `発注対象商品_YYYY-MM-DD.csv`

### エクスポートされるCSV例
```csv
商品ID,商品名,JANコード,現在在庫個数,定数在庫_個数,発注推奨箱数,発注推奨個数,単価_箱,発注推定金額,推奨発注先
PRD-001,オールシリコントレイキット12Fr 10ml,4987654321098,5,100,10,100,1200,12000,医療機器卸A
PRD-006,シリンジ10ml 横口 針なし,4987654321104,50,500,5,500,850,4250,医療機器卸A
```

## 5. CSVを使った発注記録作成（オプション）

### 方法A: 手動インポート
1. CSVをダウンロード
2. 必要に応じて編集
3. 発注記録テーブルにインポート

### 方法B: 自動処理ボット
```yaml
Bot Name: CSV発注処理
Event:
  Type: Schedule
  Time: 毎日 10:00
Process:
  Step 1: Export view to CSV
  Step 2: Save to Google Drive
  Step 3: Send email with CSV attachment
  Step 4: (Optional) Create orders from CSV
```

## 6. メリット・デメリット

### ✅ メリット
- **超簡単**: View設定のチェックボックス1つ
- **標準機能**: 追加開発不要
- **柔軟性**: Excelで編集可能
- **互換性**: どのシステムでも読める
- **高速**: 大量データも高速エクスポート

### ⚠️ デメリット
- **手動操作**: ボタンクリックが必要
- **フォーマット固定**: PDFのような装飾不可
- **2段階プロセス**: エクスポート→発注の手間

## 7. 推奨される使い方

### 小規模運用（推奨）
```
1. Export this view でCSVダウンロード
2. Excelで確認・調整
3. 承認後、手動で発注処理
```

### 大規模運用
```
1. Export this view でCSVダウンロード
2. CSV自動読み込みボット実行
3. 発注記録を一括作成
```

## 8. さらにシンプルにする工夫

### カスタムビュー名
ビュー名を「**📊 発注リスト（CSV出力）**」のようにすると分かりやすい

### ダッシュボード配置
```yaml
Dashboard View:
- Card 1: 発注対象商品数
- Card 2: 合計発注金額
- Button: 発注対象商品ビューへ（CSV出力可能）
```

### クイックアクセス
メインメニューの最上位に「発注対象商品」ビューを配置

## まとめ

**最もシンプルな実装**:
1. ビュー作成
2. Export this view をON
3. 完了

これだけで発注リストのCSV出力が可能になります。PDFテンプレート作成やボット設定は不要です。