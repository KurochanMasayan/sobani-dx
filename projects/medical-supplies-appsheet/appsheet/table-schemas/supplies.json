{
  "tableName": "supplies",
  "displayName": "医材マスタ",
  "description": "医療機器・医療材料の基本情報を管理するマスタテーブル",
  "columns": [
    {
      "name": "supply_id",
      "type": "Text",
      "displayName": "医材ID",
      "required": true,
      "key": true,
      "initialValue": "CONCATENATE(\"SUP\", TEXT(ROW(), \"000\"))",
      "editable": false,
      "description": "医材の一意識別子"
    },
    {
      "name": "supply_name",
      "type": "Text",
      "displayName": "医材名",
      "required": true,
      "searchable": true,
      "description": "医材の正式名称"
    },
    {
      "name": "category",
      "type": "Enum",
      "displayName": "カテゴリ",
      "required": true,
      "enumValues": ["消耗品", "機器", "薬剤", "その他"],
      "description": "医材の分類"
    },
    {
      "name": "subcategory",
      "type": "Text",
      "displayName": "サブカテゴリ",
      "required": false,
      "description": "詳細な分類"
    },
    {
      "name": "manufacturer",
      "type": "Text",
      "displayName": "メーカー名",
      "required": false,
      "description": "製造メーカー"
    },
    {
      "name": "model_number",
      "type": "Text",
      "displayName": "型番",
      "required": false,
      "description": "製品の型番"
    },
    {
      "name": "jan_code",
      "type": "Text",
      "displayName": "JANコード",
      "required": false,
      "description": "商品識別用バーコード"
    },
    {
      "name": "unit_price",
      "type": "Number",
      "displayName": "単価",
      "required": false,
      "decimalDigits": 2,
      "description": "1単位あたりの価格（円）"
    },
    {
      "name": "unit",
      "type": "Text",
      "displayName": "単位",
      "required": true,
      "description": "数量の単位（箱、個、本など）"
    },
    {
      "name": "supplier",
      "type": "Text",
      "displayName": "供給業者",
      "required": false,
      "description": "主要な供給業者名"
    },
    {
      "name": "safety_stock",
      "type": "Number",
      "displayName": "安全在庫数",
      "required": true,
      "initialValue": "0",
      "description": "最低限保持すべき在庫数"
    },
    {
      "name": "reorder_point",
      "type": "Number",
      "displayName": "発注点",
      "required": true,
      "initialValue": "0",
      "description": "発注を開始する在庫レベル"
    },
    {
      "name": "storage_location",
      "type": "Text",
      "displayName": "保管場所",
      "required": false,
      "description": "標準的な保管場所"
    },
    {
      "name": "expiry_managed",
      "type": "Boolean",
      "displayName": "有効期限管理",
      "required": false,
      "initialValue": "FALSE",
      "description": "有効期限の管理が必要かどうか"
    },
    {
      "name": "description",
      "type": "LongText",
      "displayName": "説明",
      "required": false,
      "description": "医材の詳細説明"
    },
    {
      "name": "is_active",
      "type": "Boolean",
      "displayName": "有効フラグ",
      "required": true,
      "initialValue": "TRUE",
      "description": "現在使用中の医材かどうか"
    },
    {
      "name": "created_at",
      "type": "DateTime",
      "displayName": "作成日時",
      "required": true,
      "initialValue": "NOW()",
      "editable": false,
      "description": "レコード作成日時"
    },
    {
      "name": "updated_at",
      "type": "DateTime",
      "displayName": "更新日時",
      "required": true,
      "resetOnEdit": "NOW()",
      "description": "レコード更新日時"
    }
  ],
  "virtualColumns": [
    {
      "name": "total_inventory",
      "type": "Number",
      "displayName": "総在庫数",
      "formula": "SUM(SELECT(inventory[current_stock], [supply_id] = [_THISROW].[supply_id]))",
      "description": "全ロットの合計在庫数"
    },
    {
      "name": "pending_orders",
      "type": "Number",
      "displayName": "発注中数量",
      "formula": "SUM(SELECT(orders[order_quantity], AND([supply_id] = [_THISROW].[supply_id], [status] = \"発注済\")))",
      "description": "発注済みだが未入荷の数量"
    },
    {
      "name": "stock_status",
      "type": "Text",
      "displayName": "在庫ステータス",
      "formula": "IF([total_inventory] <= [safety_stock], \"在庫不足\", IF([total_inventory] <= [reorder_point], \"発注推奨\", \"適正\"))",
      "description": "在庫状況の判定"
    }
  ],
  "security": {
    "readPermission": "ROLE_USER",
    "writePermission": "ROLE_ADMIN",
    "deletePermission": "ROLE_ADMIN"
  },
  "formatting": {
    "summaryColumn": "supply_name",
    "sortBy": "supply_name"
  }
}