# 在宅診療計画書 自動作成システム セットアップガイド

## 概要

患者CSVから在宅診療計画書を自動生成するGoogle Apps Scriptシステム。

## 必要な設定

### 1. Script Properties

GASエディタで「プロジェクトの設定」→「スクリプト プロパティ」から設定：

| プロパティ名 | 説明 | 例 |
|------------|------|-----|
| `PATIENT_CSV_FOLDER_ID` | 患者CSVを配置するGoogle DriveフォルダのID | `1ABC...xyz` |
| `OUTPUT_FOLDER_ID` | 生成したスプレッドシートを保存するフォルダのID | `1DEF...uvw` |

### 2. 必要なシート（テンプレートスプレッドシート内）

スクリプトを実行するスプレッドシートに以下のシートを作成：

#### 2.1 `原本` シート（必須）

テンプレートシート。以下のセルにデータが書き込まれる：

| セル | 内容 | CSVカラム |
|-----|------|----------|
| H2 | 作成日 | （実行日） |
| B4 | 患者氏名 | A列 |
| K4 | 性別 | D列 |
| B5 | 生年月日 | B列 |
| J5 | 年齢 | C列 |
| C6 | 郵便番号 | E列 |
| B7 | 住所 | F列 |
| B8 | 診断名 | G列 |
| B12 | 在宅療養計画の要点 | L列 |
| B16 | 日常生活や介護サービスを利用する上での留意点 | M列 |
| D19 | 寝たきり度 | I列 |
| G19 | 認知度 | J列 |
| J19 | 介護認定 | K列 |

#### 2.2 `事業所ファイル台帳` シート（必須）

生成したファイルの管理台帳。以下のヘッダーで作成：

| A列 | B列 | C列 | D列 |
|-----|-----|-----|-----|
| 年月 | 居宅支援事業所名 | URL | 最終更新 |

#### 2.3 `進行管理` シート（自動作成）

処理状況を表示するシート。存在しない場合は自動作成される。

## 入力CSV形式

エンコーディング: **Shift-JIS (cp932)**

| 列 | 内容 |
|----|------|
| A | 患者名 |
| B | 生年月日（例: 昭和60年07月18日） |
| C | 年齢（例: 40歳）※「歳」は自動削除 |
| D | 性別 |
| E | 郵便番号（例: 064-0954） |
| F | 住所 |
| G | 診断名（複数行可） |
| H | 施設名（事業所名） |
| I | 寝たきり度（例: A2, B2） |
| J | 認知度（例: Ⅱb, Ⅲa） |
| K | 介護認定（例: 要介護2） |
| L | 在宅療養計画の要点（複数行可） |
| M | 日常生活や介護サービスを利用する上での留意点 |

## 実行関数

| 関数名 | 用途 |
|-------|------|
| `startPlanGeneration` | 計画書生成を開始（ボタンやメニューに設定） |
| `onOpen` | スプレッドシート起動時にメニュー追加（自動実行） |

### ボタンに設定する場合

1. スプレッドシートで「挿入」→「図形描画」でボタンを作成
2. 作成した図形を右クリック →「スクリプトを割り当て」
3. `startPlanGeneration` を入力

## 使い方

1. CSVファイルを `PATIENT_CSV_FOLDER_ID` で指定したフォルダに配置
2. テンプレートスプレッドシートを開く
3. メニュー「在宅診療計画書」→「計画書生成（開始）」またはボタンをクリック
4. 処理完了後、`OUTPUT_FOLDER_ID` フォルダに事業所別スプレッドシートが生成される

## 出力

- ファイル名: `{年月}_{事業所名}` （例: `2025-12_テスト施設`）
- シート名: `{患者名}_{日付}` （例: `テスト一郎_2025-12-13`）
- 同一事業所・同一年月の患者は1つのスプレッドシートにまとめられる

## 注意事項

- 処理完了後、元のCSVファイルはゴミ箱に移動される
- 5分以上かかる場合は自動的に中断され、1分後に続きから再開される
- 同名の患者がいる場合、後のデータで上書きされる（患者名をキーとして使用）
